<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>What's Going On?</title>
        <link rel="stylesheet" href="styles.css" />
        <link
            rel="icon"
            href="public/assets/img/garfield-bg.png"
            type="image/png"
        />
        <!-- Import Lucide icons globally -->
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
        <script>
            window.addEventListener("DOMContentLoaded", () => {
                lucide.createIcons();
            });
        </script>
    </head>
    <body>
        <div class="container">
            <div class="title-container">
                <div class="title-row">
                    <h1 class="title">What's Going On?</h1>
                    <img
                        src="public/assets/img/garfield-bg.png"
                        alt="Garfield"
                        class="garfield-icon"
                    />
                </div>
                <div class="description">
                    Born from police violence targeting student protesters at
                    Berkeley, his brother's harrowing letters from Vietnam, and
                    Gaye's own grief in the wake of Tammi Terrell's death and
                    brought into a collective catharsis. Jazz-infused
                    arrangements and layered vocals - recorded in a single
                    midnight take - rejected Motown's apolitical formula,
                    bringing soul music's first protest concept album with a
                    single enduring question.
                </div>
            </div>

            <multitrack-player
                id="player"
                stylesheet="dist/multitrack-player.themed.css"
            ></multitrack-player>
        </div>

        <script type="module">
            import "./src/components/multitrack-player/multitrack-player.js";

            document.addEventListener("DOMContentLoaded", () => {
                const player = document.getElementById("player");

                document.addEventListener("keydown", (e) => {
                    if (e.code === "Space") {
                        e.preventDefault();
                        player.state.isPlaying ? player.pause() : player.play();
                    }
                });

                const title = document.querySelector(".title");

                if (title) {
                    const setAnimatedTitle = (element, text) => {
                        element.innerHTML = "";
                        for (let i = 0; i < text.length; i++) {
                            const char = text[i];
                            const span = document.createElement("span");
                            span.textContent = char === " " ? "\u00A0" : char;
                            span.style.setProperty("--i", i);
                            element.appendChild(span);
                        }
                    };

                    // Set the initial title
                    setAnimatedTitle(title, title.textContent);

                    // Observe for changes and re-apply animation if necessary
                    const observer = new MutationObserver((mutationsList) => {
                        for (const mutation of mutationsList) {
                            // If the title was changed to plain text, re-animate it

                            if (
                                mutation.type === "childList" &&
                                mutation.addedNodes.length > 0 &&
                                mutation.addedNodes[0].nodeType ===
                                    Node.TEXT_NODE
                            ) {
                                setAnimatedTitle(title, title.textContent);
                            }
                        }
                    });

                    observer.observe(title, { childList: true });
                }

                if (title) {
                    const titleContainer =
                        document.querySelector(".title-container");
                    title.addEventListener("click", () => {
                        if (titleContainer) {
                            titleContainer.classList.toggle("active");
                        }
                    });
                }
            });
        </script>
    </body>
</html>
